<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Parcsafe — Etiquetes 8×2 amb QR</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">

<style>
  :root{
    /* Configuració base */
    --rows:8; --cols:2;
    --page-margin-top:10mm;
    --page-margin-bottom:10mm;
    --page-margin-left:8mm;
    --page-margin-right:8mm;
    --gap-x:6mm; --gap-y:6mm;
    --label-pad:3mm;

    --ink:#0f1b2f; --muted:#667085; --bg:#f5f7f8; --card:#fff;
    --green:#6dbd45; --green2:#5aa83a;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:var(--ink)}

  header{
    background:#fff;padding:16px 24px;display:flex;justify-content:space-between;align-items:center;
    box-shadow:0 2px 8px rgba(0,0,0,.06)
  }
  header h1{margin:0;font-size:18px}
  .btn{
    background:linear-gradient(#7ad354,#5aa83a);border:none;color:#fff;font-weight:600;
    padding:10px 16px;border-radius:10px;cursor:pointer;transition:.2s
  }
  .btn:hover{background:linear-gradient(#8ee45d,#69c04b)}

  main{max-width:1100px;margin:20px auto;padding:0 20px;display:grid;grid-template-columns:320px 1fr;gap:20px}

  .panel{background:#fff;border:1px solid #e0e3e8;border-radius:14px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
  .panel h2{margin:0 0 12px;font-size:16px}
  .panel input,.panel textarea{width:100%;padding:8px 10px;border:1px solid #d0d5dd;border-radius:8px;margin-bottom:10px}

  .sheet{
    width:210mm;height:297mm;background:#fff;margin:0 auto;
    padding:var(--page-margin-top) var(--page-margin-right) var(--page-margin-bottom) var(--page-margin-left);
    box-shadow:0 6px 20px rgba(0,0,0,.1)
  }
  .grid{
    display:grid;
    grid-template-columns:repeat(var(--cols),1fr);
    grid-template-rows:repeat(var(--rows),1fr);
    gap:var(--gap-y) var(--gap-x);
    width:100%;height:100%;
  }
  .label{
    border:0.25mm dashed #ddd;border-radius:6px;
    padding:var(--label-pad);
    display:flex;align-items:center;justify-content:space-between;
  }
  .code{
    font-weight:700;font-size:5mm;line-height:1.1;margin-right:5mm;word-break:break-word;
  }
  .qr{width:22mm;height:22mm}
  @media print{
    @page{size:A4;margin:0}
    header,.panel{display:none!important}
    body{background:#fff}
    .sheet{box-shadow:none;margin:0}
    .label{border:none}
  }
</style>
</head>
<body>

<header>
  <h1>Parcsafe · Etiquetes 8×2 amb QR</h1>
  <div>
    <button class="btn" id="fill16">Repetir fins a 16</button>
    <button class="btn" id="printBtn">Descarrega PDF</button>
  </div>
</header>

<main>
  <section class="panel">
    <h2>1) Selecció de calaixos</h2>
    <textarea id="codes" placeholder="C2_CP2_0_I, C2_CP2_1_I, ..."></textarea>
    <button class="btn" id="apply">Aplica a la graella</button>
    <button class="btn" style="background:#ccc;color:#000" id="clear">Neteja</button>

    <h2 style="margin-top:20px">2) Plantilla QR</h2>
    <input type="text" id="qrTpl" value="https://ramonpertinezsola.github.io/C2_CP2_Web/C2/CP2/fitxes/{CODE}.html">
  </section>

  <section>
    <div class="sheet">
      <div id="grid" class="grid"></div>
    </div>
  </section>
</main>

<script>
/* QR simple */
!function(){function e(e){this.data=e}function t(e){this.data=e,this.make()}t.prototype.make=function(){var t=document.createElement("canvas"),n=t.getContext("2d"),r=256;n.fillStyle="#fff",n.fillRect(0,0,r,r);var o=r/29;for(var i=0;i<29;i++)for(var a=0;a<29;a++)Math.random()<.35&&(n.fillStyle="#000",n.fillRect(a*o,i*o,o,o));this.canvas=t};window.SimpleQR=function(e,n){t.prototype.make();e.innerHTML="",e.appendChild(t.prototype.canvas)}}();

const grid=document.getElementById('grid');
const codesArea=document.getElementById('codes');
const qrTpl=document.getElementById('qrTpl');
const fill16=document.getElementById('fill16');
const apply=document.getElementById('apply');
const clear=document.getElementById('clear');
const printBtn=document.getElementById('printBtn');

function ensureGrid(){
  grid.innerHTML='';
  for(let i=0;i<16;i++){
    const div=document.createElement('div');
    div.className='label';
    div.innerHTML=`<div class="code" data-code></div><div class="qr" data-qr></div>`;
    grid.appendChild(div);
  }
}
function parseCodes(raw){return(raw||'').split(/[\s,;]+/g).map(s=>s.trim()).filter(Boolean)}
function payloadFor(code){return(qrTpl.value||'').replaceAll('{CODE}',code)}
function render(codes){
  ensureGrid();
  const cells=[...grid.querySelectorAll('.label')];
  for(let i=0;i<Math.min(codes.length,cells.length);i++){
    const cell=cells[i],code=codes[i];
    cell.querySelector('[data-code]').textContent=code;
    const qrEl=cell.querySelector('[data-qr]');
    qrEl.innerHTML='';
    new QRCode(qrEl,{text:payloadFor(code),width:qrEl.clientWidth,height:qrEl.clientHeight});
  }
}
apply.onclick=()=>render(parseCodes(codesArea.value));
clear.onclick=()=>{codesArea.value='';ensureGrid()};
fill16.onclick=()=>{
  let c=parseCodes(codesArea.value);if(c.length===0)return;
  while(c.length<16)c.push(c[c.length-1]);
  codesArea.value=c.join('\n');render(c);
};
printBtn.onclick=()=>window.print();

ensureGrid();
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</body>
</html>
