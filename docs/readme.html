<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parcsafe Documentation ‚Äî Stock Management System</title>
  <meta name="robots" content="noindex, nofollow" />

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --green:#6dbd45;
      --ink:#1f2937;
      --muted:#667085;
      --bg:#f6f8f7;
      --card:#ffffff;
      --radius:14px;
      --shadow:0 6px 18px rgba(0,0,0,.08);
      --link:#2563eb;
      --danger:#b3261e;
      --ok:#14532d;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:'Poppins',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background:var(--bg);
    }

    .layout{display:flex;}
    nav.sidebar{
      position:fixed; left:0; top:0; bottom:0;
      width:260px; background:#fff; border-right:1px solid #e5e7eb;
      padding:24px 16px; overflow:auto; z-index:50;
    }
    .brand{display:flex; align-items:center; gap:10px; margin-bottom:18px}
    .brand img{width:145px; height:auto}
    .back-btn{
      display:inline-block; margin:10px 0 18px; padding:10px 14px;
      background:var(--green); color:#fff; border-radius:10px; text-decoration:none;
      font-weight:600; box-shadow:0 6px 14px rgba(109,189,69,.22);
    }
    .toc a{
      display:block; padding:10px 12px; border-radius:8px; text-decoration:none;
      color:var(--ink); font-weight:500; margin:3px 0; transition:.15s;
    }
    .toc a:hover{background:#f1f5f9}
    .toc a.active{background:var(--green); color:#fff}

    main{
      margin-left:260px;
      padding:42px 56px; max-width:1100px;
    }
    .card{
      background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:34px 40px; margin:26px 0;
    }
    h1{color:var(--green); font-size:30px; margin:0 0 10px}
    h2{color:var(--green); font-size:22px; margin:26px 0 12px}
    h3{color:var(--ink); font-size:18px; margin:22px 0 8px}
    p,li{line-height:1.75; color:var(--ink)}
    .lead{color:var(--muted)}

    table{width:100%; border-collapse:collapse; margin:14px 0}
    th{background:var(--green); color:#fff; text-align:left; padding:10px}
    td{border-bottom:1px solid #e5e7eb; padding:10px; color:var(--muted)}
    code{
      background:#f2f3f5; padding:2px 6px; border-radius:6px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }
    pre{
      background:#0f172a; color:#e2e8f0; padding:16px; border-radius:10px; overflow:auto; font-size:.92rem;
    }

    .floating-back{
      position:fixed; right:18px; bottom:18px; z-index:60;
      background:var(--green); color:#fff; text-decoration:none; font-weight:600;
      padding:12px 16px; border-radius:999px; box-shadow:0 10px 24px rgba(109,189,69,.35);
    }
    footer{color:var(--muted); font-size:13px; text-align:center; margin:40px 0 10px}

    .badge{display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:700}
    .ok{background:#ecfdf5; color:var(--ok); border:1px solid #bbf7d0}
    .warn{background:#fef2f2; color:#7f1d1d; border:1px solid #fecaca}
    .tip{background:#f0fdf4; color:#14532d; border:1px solid #bbf7d0}
    .muted{color:var(--muted)}
    .kbd{border:1px solid #e5e7eb; border-bottom-width:3px; padding:2px 6px; border-radius:6px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; background:#fff}

    .checklist li{margin:8px 0}
    .two-col{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    @media (max-width:980px){nav.sidebar{width:220px} main{margin-left:220px; padding:28px}}
    @media (max-width:760px){nav.sidebar{width:200px; padding:18px 10px} main{margin-left:200px; padding:24px} .back-btn{display:block; text-align:center} .two-col{grid-template-columns:1fr}}
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const links = [...document.querySelectorAll('.toc a')];
      const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);
      const io = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if(entry.isIntersecting){
            const id = '#' + entry.target.id;
            links.forEach(l => l.classList.toggle('active', l.getAttribute('href') === id));
          }
        });
      }, {rootMargin: '-40% 0px -55% 0px', threshold: 0});
      sections.forEach(s => io.observe(s));
    });
  </script>
</head>

<body>
  <div class="layout">
    <nav class="sidebar">
      <div class="brand">
        <img src="assets/parcsafe-logo.png" alt="Parcsafe logo">
      </div>
      <a class="back-btn" href="index.html">‚¨Ö Back to Main Menu</a>
      <a class="back-btn" href="valuation/index.html" style="background:#14532d;margin-top:4px;">
      üìä View Project Valuation
      </a>


      <div class="toc">
        <a href="#overview">Overview</a>
        <a href="#quickstart">Quick Start (60s)</a>
        <a href="#roles">Who does what?</a>
        <a href="#daily-weekly">Daily / Weekly tasks</a>
        <a href="#architecture">System Architecture</a>
        <a href="#data-model">Data Model (CSV)</a>
        <a href="#api">API Contract</a>
        <a href="#worker">Cloudflare Worker</a>
        <a href="#github">GitHub & Pages</a>
        <a href="#frontend">Frontend & UX</a>
        <a href="#images">Images & Naming</a>
        <a href="#qr-labels">QR Labels & Paths</a>
        <a href="#drawers-new">Create a new drawer</a>
        <a href="#move-products">Move/duplicate products</a>
        <a href="#backup">Backup & Restore CSV</a>
        <a href="#troubleshooting">Troubleshooting</a>
        <a href="#limits">Known Limitations</a>
        <a href="#browser">Browser & Mobile tips</a>
        <a href="#security">Security & Access</a>
        <a href="#faq">FAQ</a>
        <a href="#roadmap">Roadmap</a>
        <a href="#glossary">Glossary</a>
        <a href="#changelog">Change Log</a>
        <a href="#author">Author</a>
      </div>
    </nav>

    <main>
      <section id="overview" class="card">
        <h1>Parcsafe Stock Management System</h1>
        <p class="lead">
          Warehouse stock from your browser. Open a drawer page, check quantities, edit, and upload photos. Changes are versioned in GitHub and appear within seconds.
        </p>
        <p class="badge ok">Safe to use without technical knowledge</p>
        <p class="muted">Tip: this guide is for everyday use. Technical details exist but are skippable.</p>
      </section>

      <section id="quickstart" class="card">
        <h2>‚ö° Quick Start (60 seconds)</h2>
        <ol class="checklist">
          <li>Open the <strong>Main Menu</strong> ‚Üí choose the <strong>Rack</strong> (A, C2-CP2, C3, C4‚Ä¶).</li>
          <li>Click the <strong>Drawer code</strong> (e.g. <span class="kbd">A1_0</span>) to open its page.</li>
          <li>To change a quantity, type the new number and press <strong>Save</strong>.</li>
          <li>Wait <strong>30‚Äì60 s</strong> and refresh the page to see it updated for everyone.</li>
          <li>To change <em>Name / Code / Description</em>, edit the fields and <strong>Save</strong> (shared across drawers of the same product).</li>
          <li>To update the photo, use <em>Upload</em> on the image, then refresh after a few seconds.</li>
        </ol>
        <p class="tip badge">If in doubt: Save ‚Üí wait half a minute ‚Üí refresh.</p>
      </section>

      <section id="roles" class="card">
        <h2>üë• Who does what?</h2>
        <div class="two-col">
          <div>
            <h3>Basic user (warehouse team)</h3>
            <ul>
              <li>Search racks/drawers, update <strong>stockQty</strong>.</li>
              <li>Update product <strong>description/code/name</strong> when needed.</li>
              <li>Upload/replace drawer photos.</li>
            </ul>
          </div>
          <div>
            <h3>Power user (supervisor)</h3>
            <ul>
              <li>Create a new drawer page (template) and add rows to CSV.</li>
              <li>Move/duplicate lines between drawers, keeping product info consistent.</li>
              <li>Handle CSV backup/restore if something goes wrong.</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="daily-weekly" class="card">
        <h2>üóìÔ∏è Daily / Weekly tasks</h2>
        <div class="two-col">
          <div>
            <h3>Daily</h3>
            <ul>
              <li>Open drawers you will pick from and verify <strong>stockQty</strong>.</li>
              <li>After picking, update the quantities and <strong>Save</strong>.</li>
              <li>Refresh once after 30‚Äì60 s to double-check.</li>
            </ul>
          </div>
          <div>
            <h3>Weekly</h3>
            <ul>
              <li>Clean up descriptions (short, consistent wording).</li>
              <li>Compress/replace large or blurry photos.</li>
              <li>Export a <strong>CSV backup</strong> (see ‚ÄúBackup & Restore‚Äù).</li>
            </ul>
          </div>
        </div>
      </section>

      <section id="architecture" class="card">
        <h2>üß† System Architecture</h2>
        <p>Frontend on <strong>GitHub Pages</strong> + <strong>Cloudflare Worker</strong> write API + optional <strong>n8n</strong> for photo sync.</p>
        <h3>Data Flow (high level)</h3>
        <ol>
          <li>User updates a value ‚Üí Browser calls <code>POST /stock/item</code> on the Worker.</li>
          <li>Worker patches <code>docs/stock.csv</code> and commits to GitHub.</li>
          <li>GitHub Pages rebuilds ‚Üí updated UI.</li>
        </ol>
      </section>

      <section id="data-model" class="card">
        <h2>üóÉÔ∏è Data Model (CSV)</h2>
        <table>
          <tr><th>Column</th><th>Type</th><th>Notes</th></tr>
          <tr><td>drawerCode</td><td>string (ID)</td><td>e.g., <code>C2_CP2_0_I</code>. Primary key per row.</td></tr>
          <tr><td>stockQty</td><td>integer ‚â• 0</td><td>Visible quantity. No decimals.</td></tr>
          <tr><td>productName</td><td>string</td><td>Human-readable name.</td></tr>
          <tr><td>productCode</td><td>string</td><td>ERP/vendor ref.</td></tr>
          <tr><td>description</td><td>string</td><td>Short, consistent; avoid line breaks.</td></tr>
          <tr><td>minStock</td><td>integer ‚â• 0</td><td>For low-stock alerts (optional workflow).</td></tr>
        </table>
        <p class="warn badge"><strong>Shared info:</strong> product <em>name/code/description</em> are shared if the same product exists in multiple drawers.</p>
      </section>

      <section id="api" class="card">
        <h2>üîó API Contract</h2>
        <pre><code>POST /stock/item
Content-Type: application/json

{"drawerCode":"C2_CP2_0_I","newQty":7}</code></pre>
        <table>
          <tr><th>Status</th><th>Body</th><th>Meaning</th></tr>
          <tr><td>200</td><td><code>{"ok":true,"updated":{"drawerCode":"...","stockQty":7}}</code></td><td>Committed.</td></tr>
          <tr><td>400</td><td><code>{"ok":false,"error":"INVALID_INPUT"}</code></td><td>Missing/invalid fields.</td></tr>
          <tr><td>404</td><td><code>{"ok":false,"error":"DRAWER_NOT_FOUND"}</code></td><td>No matching row.</td></tr>
          <tr><td>401/403</td><td><code>{"ok":false,"error":"AUTH"}</code></td><td>Token/permission issue.</td></tr>
          <tr><td>500</td><td><code>{"ok":false,"error":"GITHUB_WRITE_FAILED"}</code></td><td>Commit/GitHub failure.</td></tr>
        </table>
      </section>

      <section id="worker" class="card">
        <h2>ü™Ñ Cloudflare Worker</h2>
        <h3>Deploy</h3>
        <pre><code>npm i -g wrangler
wrangler login
wrangler deploy
wrangler secret put GH_TOKEN</code></pre>
        <ul>
          <li><strong>GH_TOKEN</strong> scope: Repo Contents (Read/Write) for this repository only.</li>
          <li>CORS restricts to the production origin.</li>
        </ul>
      </section>

      <section id="github" class="card">
        <h2>üêô GitHub & Pages</h2>
        <ul>
          <li>Default branch builds GitHub Pages automatically.</li>
          <li>Each CSV update is a commit ‚Üí rebuild happens shortly after.</li>
        </ul>
        <h3>Repository at a glance</h3>
        <ul class="muted">
          <li><code>docs/stock.csv</code> ‚Äî canonical data</li>
          <li><code>docs/readme.html</code> ‚Äî this document</li>
          <li><code>docs/&lt;Rack&gt;/fitxes/&lt;DrawerCode&gt;.html</code> ‚Äî drawer pages (e.g. <code>A/fitxes/A1_0.html</code>, <code>C3/fitxes/C3_5_I.html</code>)</li>
          <li><code>docs/&lt;Rack&gt;/images/</code> ‚Äî photos per rack</li>
        </ul>
      </section>

      <section id="frontend" class="card">
        <h2>üñ•Ô∏è Frontend & UX</h2>
        <ul>
          <li>Each drawer page has <strong>Save</strong> for CSV updates and <strong>Upload</strong> for photos.</li>
          <li>After saving: wait 30‚Äì60 s and refresh (mobile: close/open tab).</li>
        </ul>
      </section>

      <section id="images" class="card">
        <h2>üñºÔ∏è Images & Naming</h2>
        <ul>
          <li>Use <strong>JPG</strong> for photos (max ~1 MB). <strong>PNG</strong> only for logos/icons.</li>
          <li>Name drawer photos like the <strong>drawerCode</strong> when possible (e.g., <code>A1_0.jpg</code>).</li>
          <li>Store in the rack‚Äôs <code>images</code> folder (e.g., <code>A/images/</code>, <code>C3/images/</code>).</li>
        </ul>
      </section>

      <section id="qr-labels" class="card">
        <h2>üè∑Ô∏è QR Labels & Paths</h2>
        <p>QRs should open the exact drawer page URL. Use these path patterns (working examples):</p>
        <ul>
          <li><code>A/fitxes/A1_0.html</code> ‚úÖ (not <code>A1/fitxes/A1_0.html</code>)</li>
          <li><code>C3/fitxes/C3_5_I.html</code> ‚úÖ (not <code>C3/0/fitxes/...</code>)</li>
          <li><code>C2_CP2/fitxes/C2_CP2_0_I.html</code> (adapt to your current rack structure)</li>
        </ul>
        <p class="tip badge">When a QR doesn‚Äôt open: check the folder structure and that the rack segment exists (e.g., <code>A/fitxes/‚Ä¶</code>).</p>
      </section>

      <section id="drawers-new" class="card">
        <h2>üß© Create a new drawer</h2>
        <ol>
          <li>Duplicate an existing drawer HTML in the same rack‚Äôs <code>fitxes</code> folder.</li>
          <li>Rename the file to the new <strong>drawerCode</strong> (e.g., <code>A/fitxes/A1_1.html</code>).</li>
          <li>Open it and update the page title and initial table rows (empty or template rows).</li>
          <li>Add corresponding rows to <code>docs/stock.csv</code> for that <strong>drawerCode</strong>.</li>
          <li>Commit and open the page ‚Üí verify fields save correctly.</li>
        </ol>
        <p class="warn badge">Make sure <strong>drawerCode</strong> in CSV matches the HTML filename and internal code exactly (case-sensitive).</p>
      </section>

      <section id="move-products" class="card">
        <h2>üîÅ Move / duplicate products between drawers</h2>
        <ol>
          <li>In <strong>CSV</strong>: copy the row(s) and change only the <strong>drawerCode</strong> and <strong>stockQty</strong> for the new location.</li>
          <li>Keep the same <strong>productName/productCode/description</strong> to preserve shared info.</li>
          <li>Commit the change and open both drawers to verify counts and text.</li>
        </ol>
        <p class="tip badge">Descriptions and codes are shared: edit once, it updates everywhere that product appears.</p>
      </section>

      <section id="backup" class="card">
        <h2>üõü Backup & Restore CSV</h2>
        <h3>Backup (weekly)</h3>
        <ol>
          <li>Open <code>docs/stock.csv</code> in GitHub ‚Üí <em>Raw</em> ‚Üí save locally as <code>stock-YYYY-MM-DD.csv</code>.</li>
          <li>Optionally create a tag/commit message: <code>backup(stock): YYYY-MM-DD</code>.</li>
        </ol>
        <h3>Restore</h3>
        <ol>
          <li>Upload the backup file to replace <code>docs/stock.csv</code> (via PR or direct commit).</li>
          <li>Wait for Pages rebuild and verify a couple of drawers.</li>
        </ol>
        <p class="warn badge">Never paste spreadsheet exports that alter separator/encoding. Keep the header exactly as defined.</p>
      </section>

      <section id="troubleshooting" class="card">
        <h2>ü©∫ Troubleshooting</h2>
        <table>
          <tr><th>Issue</th><th>Cause</th><th>Fix</th></tr>
          <tr><td>Change not visible</td><td>CDN cache / rebuild delay</td><td>Wait 30‚Äì60 s and refresh (Ctrl/Cmd+R). On mobile, close and reopen tab.</td></tr>
          <tr><td>Description changed elsewhere</td><td>Shared product info</td><td>Expected. Product text is shared across drawers for the same product.</td></tr>
          <tr><td>Cannot upload photo</td><td>File too large / wrong type</td><td>Use JPG ~1 MB; retry on good Wi-Fi.</td></tr>
          <tr><td>404 on QR</td><td>Wrong path in QR</td><td>Use <code>A/fitxes/A1_0.html</code> style (see ‚ÄúQR Labels & Paths‚Äù).</td></tr>
          <tr><td>401/403 from API</td><td>Token/permission issue</td><td>Refresh Worker secret <code>GH_TOKEN</code> and re-deploy.</td></tr>
          <tr><td>CSV not updating</td><td>Header mismatch / wrong drawerCode</td><td>Check header order & exact ID; see API 400/404.</td></tr>
        </table>
      </section>

      <section id="limits" class="card">
        <h2>‚ö†Ô∏è Known Limitations</h2>
        <ul>
          <li>Edits may take up to ~1 minute to appear for everyone (static hosting rebuild + cache).</li>
          <li>CSV is single-source of truth: concurrent manual edits in GitHub UI can conflict.</li>
          <li>Mobile uploads depend on network quality; large photos may be slow.</li>
        </ul>
      </section>

      <section id="browser" class="card">
        <h2>üì± Browser & Mobile tips</h2>
        <ul>
          <li>Use latest Chrome/Edge/Safari. Allow popups for Worker auth prompts if any.</li>
          <li>Add the Main Menu to your phone‚Äôs home screen for 1-tap access.</li>
          <li>When in doubt: refresh after saving.</li>
        </ul>
      </section>

      <section id="security" class="card">
        <h2>üîí Security & Access</h2>
        <ul>
          <li><strong>Token storage:</strong> never hard-coded; Cloudflare secret only.</li>
          <li><strong>Least privilege:</strong> GitHub token limited to this repo.</li>
          <li><strong>CORS:</strong> only the production origin can call the API.</li>
          <li><strong>Audit:</strong> each update is a commit by the Worker identity.</li>
        </ul>
      </section>

      <section id="faq" class="card">
        <h2>‚ùì FAQ</h2>
        <h3>Can we add new CSV columns?</h3>
        <p>Yes, but update the Worker to keep validation and column order. Treat new columns as optional at first.</p>
        <h3>Can we restrict edits?</h3>
        <p>Yes. Add a signed token/session on the frontend and validate it in the Worker.</p>
      </section>

      <section id="roadmap" class="card">
        <h2>üó∫Ô∏è Roadmap</h2>
        <ul>
          <li>Inline CSV editor dashboard with auth</li>
          <li>Audit trail view (who/what/when)</li>
          <li>Automated image optimization (WebP/AVIF)</li>
          <li>Integrations (Circontrol / NWave)</li>
        </ul>
      </section>

      <section id="glossary" class="card">
        <h2>üìö Glossary</h2>
        <p><strong>DrawerCode</strong>: Unique drawer identifier (e.g., <code>A1_0</code>, <code>C2_CP2_0_I</code>).</p>
        <p><strong>Worker</strong>: Cloudflare serverless function that updates the repo.</p>
        <p><strong>Pages</strong>: GitHub static hosting for the site.</p>
      </section>

      <section id="changelog" class="card">
        <h2>üìù Change Log</h2>
        <ul>
          <li><strong>v1.1</strong> ‚Äî Added Quick Start, tasks, new drawer guide, QR paths, backup/restore, limitations, and mobile tips.</li>
          <li><strong>v1.0</strong> ‚Äî Initial corporate documentation, fixed sidebar, back-to-menu button, technical sections.</li>
        </ul>
      </section>

      <section id="author" class="card">
        <h2>üë§ Author</h2>
        <p><strong>Developed by:</strong> Ramon Pert√≠√±ez Sol√† ‚Äî Electrical Engineer & Automation Specialist.</p>
        <p>Brisbane, Australia ‚Äî 2025 ¬∑ <a href="mailto:ramonpertinezsola@gmail.com">ramonpertinezsola@gmail.com</a></p>
      </section>

      <footer>¬© 2025 Parcsafe ‚Äî Internal Documentation ¬∑ Version 1.1</footer>
    </main>
  </div>

  <a class="floating-back" href="index.html" title="Back to Main Menu">Main Menu</a>
</body>
</html>
